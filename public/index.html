<html>

<head>
    <title>Boter Kaas en Eieren</title>
    <link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/components/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/app.css" />

</head>

<body>
    <div id="app"></div>

    <script src="/components/jquery/dist/jquery.min.js"></script>
    <script src="/components/nunjucks/browser/nunjucks.min.js"></script>
    <script src="/components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script>
        var vs = "computer"
        var player1 = "X"
        var player2 = "O"
        var turn = false
        var cpuRow = 99
        var cpuColumn = 99
        var turnCount = 0
        var player1Won = false
        var player2Won = false
        var computerWon = false
        var end = false
        var playfield = [
          ['', '', '',],
          ['', '', '',],
          ['', '', '']
        ];

        var Home = {
            turn : function(){
                $(".reset").click(function(e) {
                    Home.restart()
                })

                $(".player").click(function(e) {
                    vs = "player2"
                    alert("X = player 1   |   O = player 2")
                })
                $(".block").click(function(e) {
                    const row = (this).dataset.row
                    const col = (this).dataset.column

                        if(turn === false){
                            turnCount++
                            console.log(turnCount);
                            if(Home.checkOccupied(row, col)){
                                playfield[row][col] = player1
                                $("div.block.col-xs-4.blocks[data-row='"+ row +"'][data-column='"+ col +"']").addClass("fa fa-times");

                                if(Home.checkWin()){
                                    Home.endGame()
                                }
                                else{
                                    turn = true
                                    if(vs === "computer"){
                                        if(turnCount != 9){
                                            Home.setComputerTurn()
                                        }
                                        else{
                                            Home.endGame()
                                        }
                                    }
                                    else{
                                        Home.endGame()
                                    }
                                }
                            }
                        }
                        else if(turn === true) {
                            if(vs === "player2"){
                                turnCount++
                                console.log(turnCount);
                                if(Home.checkOccupied(row, col)){
                                    playfield[row][col] = player2
                                    $("div.block.col-xs-4.blocks[data-row='"+ row +"'][data-column='"+ col +"']").addClass("fa fa-circle-o")

                                    if(Home.checkWin()){
                                        Home.endGame()
                                    }
                                    else{
                                        turn = false
                                    }
                                }
                            }
                        }
                })
            },

            checkWin : function(){
                                        //horizontaal
                //row1+column1 & row1+column2 & row1+column3 = hetzelfde > WIN
                if(playfield[0][0] === playfield[1][0] && playfield[0][0] === playfield[2][0]){
                    if(playfield[0][0] === player1){
                        return player1Won = true
                    }else if(playfield[0][0] === player2){
                        return player2Won = true
                    }
                }
                //row2+column1 & row2+column2 & row2+column3 = hetzelfde > WIN
                if(playfield[0][1] === playfield[1][1] && playfield[0][1] === playfield[2][1]){
                    if(playfield[0][1] === player1){
                        return player1Won = true
                    }else if(playfield[0][1] === player2){
                        return player2Won = true
                    }
                }
                //row3+column1 & row3+column2 & row3+column3 = hetzelfde > WIN
                if(playfield[0][2] === playfield[1][2] && playfield[0][2] === playfield[2][2]){
                    if(playfield[0][2] === player1){
                        return player1Won = true
                    }else if(playfield[0][2] === player2){
                        return player2Won = true
                    }
                }
                                        //verticaal
                //column1+row1 & column1+row2 & column1+row3 = hetzelfde > WIN
                if(playfield[0][0] === playfield[0][1] && playfield[0][0] === playfield[0][2]){
                    if(playfield[0][0] === player1){
                        return player1Won = true
                    }else if(playfield[0][0] === player2){
                        return player2Won = true
                    }
                }

                //column2+row1 & column2+row2 & column2+row3 = hetzelfde > WIN
                if(playfield[1][0] === playfield[1][1] && playfield[1][0] === playfield[1][2]){
                    if(playfield[1][0] === player1){
                        return player1Won = true
                    }else if(playfield[1][0] === player2){
                        return player2Won = true
                    }
                }

                //column3+row1 & column3+row2 & column3+row3 = hetzelfde > WIN
                if(playfield[2][0] === playfield[2][1] && playfield[2][0] === playfield[2][2]){
                    if(playfield[2][0] === player1){
                        return player1Won = true
                    }else if(playfield[2][0] === player2){
                        return player2Won = true
                    }
                }
                                        //kruislings
                //row1+column1 & row2+column2 & row3+colum3 = hetzelfde > WIN
                if(playfield[0][0] === playfield[1][1] && playfield[0][0] === playfield[2][2]){
                    if(playfield[0][0] === player1){
                        return player1Won = true
                    }else if(playfield[0][0] === player2){
                        return player2Won = true
                    }
                }

                //row3+column1 & row2+column2 & row1+colum3 = hetzelfde > WIN
                if(playfield[2][0] === playfield[1][1] && playfield[2][0] === playfield[0][2]){
                    if(playfield[2][0] === player1){
                        return player1Won = true
                    }else if(playfield[2][0] === player2){
                        return player2Won = true
                    }
                }

            },

            checkOccupied : function(row, col){
                if(playfield[row][col] === ""){
                    return true
                }
                else if(turn === false){
                    alert("bezet!!")
                    return false
                }
                else {
                    return false
                }
            },

            setComputerTurn : function(){
                /*
                if(playfield[1][1] != "X" && playfield[1][1] != "O"){
                    //plaats zet in het midden
                    cpuRow = 1
                    cpuColumn = 1
                }
                */
                turnCount++
                console.log(turnCount);
                cpuRow = Home.randomRowOrCol(0,2)
                cpuColumn = Home.randomRowOrCol(0,2)

                while(!Home.checkOccupied(cpuRow,cpuColumn)){
                    cpuRow = Home.randomRowOrCol(0,2)
                    cpuColumn = Home.randomRowOrCol(0,2)

                    if(jQuery.inArray("", playfield) !== -1){
                        Home.endGame()
                    }

                }
                playfield[cpuRow][cpuColumn] = player2
                $("div.block.col-xs-4.blocks[data-row='"+ cpuRow +"'][data-column='"+ cpuColumn +"']").html(player2)

                if(Home.checkWin() === true){
                    Home.endGame()
                }
                else{
                    turn = false
                }
            },
            calculateComputerTurn : function(){
                //controleer mogelijke winpoging van de tegenstander
                if(playfield[0][0] === '' && ((playfield[0][1] === "X" && playfield[0][2] === "X") ||
                (playfield[1][0] === "X" && playfield[2][0] === "X"))){
                    cpuRow = 0
                    cpuColumn = 0
                    return true
                }
                else if((playfield[0][1] === '') && (playfield[0][0] === "X" && playfield[0][2] === "X") ||
                (playfield[1][1] === "X" && playfield[2][1] === "X")){
                    cpuRow = 0
                    cpuColumn = 1
                    return true
                }
                else if((playfield[0][2] === '') && (playfield[0][0] === "X" && playfield[0][1] === "X") ||
                (playfield[1][2] === "X" && playfield[2][2] === "X")){
                    cpuRow = 0
                    cpuColumn = 2
                    return true
                }
                else if((playfield[1][0] === '') && (playfield[0][0] === "X" && playfield[2][0] === "X") ||
                (playfield[1][1] === "X" && playfield[1][2] === "X")){
                    cpuRow = 1
                    cpuColumn = 0
                    return true
                }
                else if((playfield[1][1] === '') && (playfield[1][0] === "X" && playfield[1][2] === "X") ||
                (playfield[0][1] === "X" && playfield[2][1] === "X")){
                    cpuRow = 1
                    cpuColumn = 1
                    return true
                }
                else if((playfield[1][2] === '') && (playfield[1][0] === "X" && playfield[1][1] === "X") ||
                (playfield[0][2] === "X" && playfield[2][2] === "X")){
                    cpuRow = 1
                    cpuColumn = 2
                    return true
                }
                else if((playfield[2][0] === '') && (playfield[0][0] === "X" && playfield[1][0] === "X") ||
                (playfield[2][1] === "X" && playfield[2][2] === "X")){
                    cpuRow = 2
                    cpuColumn = 0
                    return true
                }
                else if((playfield[2][1] === '') && (playfield[0][0] === "X" && playfield[1][1] === "X") ||
                (playfield[2][0] === "X" && playfield[2][2] === "X")){
                    cpuRow = 2
                    cpuColumn = 1
                    return true
                }
                else if((playfield[2][2] === '') && (playfield[0][2] === "X" && playfield[1][2] === "X") ||
                (playfield[2][0] === "X" && playfield[2][1] === "X")){
                    cpuRow = 2
                    cpuColumn = 2
                    return true
                }
                //controleer mogelijke winpoging van de computer zelf
                if((playfield[0][0] === '') && (playfield[0][1] === "O" && playfield[0][2] === "O") ||
                (playfield[1][0] === "O" && playfield[2][0] === "O")){
                    cpuRow = 0
                    cpuColumn = 0
                    return true
                }
                if((playfield[0][1] === '') && (playfield[0][0] === "O" && playfield[0][2] === "O") ||
                (playfield[1][1] === "O" && playfield[2][1] === "O")){
                    cpuRow = 0
                    cpuColumn = 1
                    return true
                }
                if((playfield[0][2] === '') && (playfield[0][0] === "O" && playfield[0][1] === "O") ||
                (playfield[1][2] === "O" && playfield[2][2] === "O")){
                    cpuRow = 0
                    cpuColumn = 2
                    return true
                }
                if((playfield[1][0] === '') && (playfield[0][0] === "O" && playfield[2][0] === "O") ||
                (playfield[1][1] === "O" && playfield[1][2] === "O")){
                    cpuRow = 1
                    cpuColumn = 0
                    return true
                }
                if((playfield[1][1] === '') && (playfield[1][0] === "O" && playfield[1][2] === "O") ||
                (playfield[0][1] === "O" && playfield[2][1] === "O")){
                    cpuRow = 1
                    cpuColumn = 1
                    return true
                }
                if((playfield[1][2] === '') && (playfield[1][0] === "O" && playfield[1][1] === "O") ||
                (playfield[0][2] === "O" && playfield[2][2] === "O")){
                    cpuRow = 1
                    cpuColumn = 2
                    return true
                }
                if((playfield[2][0] === '') && (playfield[0][0] === "O" && playfield[1][0] === "O") ||
                (playfield[2][1] === "O" && playfield[2][2] === "O")){
                    cpuRow = 2
                    cpuColumn = 0
                    return true
                }
                if((playfield[2][1] === '') && (playfield[0][0] === "O" && playfield[1][1] === "O") ||
                (playfield[2][0] === "O" && playfield[2][2] === "O")){
                    cpuRow = 2
                    cpuColumn = 1
                    return true
                }
                if((playfield[2][2] === '') && (playfield[0][2] === "O" && playfield[1][2] === "O") ||
                (playfield[2][0] === "O" && playfield[2][1] === "O")){
                    cpuRow = 2
                    cpuColumn = 2
                    return true
                }
                return false

            },

            //random getal tussen 0 en 2(om positie te bepalen[row,col])
            randomRowOrCol : function(min, max){
                return Math.floor(Math.random()*(max-min+1)+min)
            },

            endGame : function(){
                if(player1Won){
                    alert("Speler 1 heeft gewonnen!")
                    end = true
                }
                else if(player2Won){
                    if(vs === "computer"){
                        alert("Computer heeft gewonnen!")
                        end = true
                    }
                    else if(vs === "player2"){
                        alert("Speler 2 heeft gewonnen!")
                        end = true
                    }
                }
                else if(turnCount === 9){
                    alert("Gelijkspel!!")
                    end = true
                }
                if (end === true){
                    Home.disableField()
                }
            },
            disableField : function(){
                turn = null
                    $(".block").addClass("disabledbutton");
            },

            restart : function(){
                turn = false
                playfield = [
                  ['', '', '',],
                  ['', '', '',],
                  ['', '', '']
                ];
                player1Won = false
                player2Won = false
                computerWon = false
                end = false
                cpuRow = 4
                cpuColumn = 4
                turnCount = 0
                for (var i = 0; i < playfield.length; i++) {
                    for (var j = 0; j < playfield.length; j++) {
                        $("div.block.col-xs-4.blocks[data-row='"+ i +"'][data-column='"+ j +"']").removeClass("disabledbutton")
                        if($("div.block.col-xs-4.blocks[data-row='"+ i +"'][data-column='"+ j +"']").hasClass("fa fa-times")){
                            $("div.block.col-xs-4.blocks[data-row='"+ i +"'][data-column='"+ j +"']").removeClass("fa fa-times")
                        }
                        if($("div.block.col-xs-4.blocks[data-row='"+ i +"'][data-column='"+ j +"']").hasClass("fa fa-circle-o")){
                            $("div.block.col-xs-4.blocks[data-row='"+ i +"'][data-column='"+ j +"']").removeClass("fa fa-circle-o")
                        }
                    }
                }
                Home.render()
            },
            render : function(){
                $("#app").html(nunjucks.render("/templates/home.html"))
                Home.turn()
            }
        }
        Home.render()
    </script>
</body>

</html>
